# Character Extraction Command

## æ¦‚è¦

`/extract_character` ã‚³ãƒãƒ³ãƒ‰ã¯ã€Segment Anything Model (SAM) ã¨ YOLOv8 ã‚’çµ„ã¿åˆã‚ã›ã¦ã€æ¼«ç”»ç”»åƒã‹ã‚‰ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚’è‡ªå‹•çš„ã«æŠ½å‡ºã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```bash
# å˜ä¸€ç”»åƒã®å‡¦ç†ï¼ˆåŸºæœ¬ï¼‰
/extract_character path/to/image.jpg

# å‡ºåŠ›å…ˆã‚’æŒ‡å®š
/extract_character path/to/image.jpg -o output/character

# ãƒã‚¹ã‚¯ã¨é€æ˜èƒŒæ™¯ç‰ˆã‚‚ä¿å­˜
/extract_character path/to/image.jpg --save-mask --save-transparent

# ãƒãƒƒãƒå‡¦ç†
/extract_character input_directory/ --batch -o output_directory/

# ãƒãƒƒãƒå‡¦ç†ï¼ˆå…¨ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
/extract_character input_directory/ --batch -o output_directory/ --save-mask --save-transparent
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³

- `--enhance-contrast`: ç”»åƒã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã‚’å¼·åŒ–
- `--filter-text`: ãƒ†ã‚­ã‚¹ãƒˆé ˜åŸŸã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ONï¼‰
- `--save-mask`: ãƒã‚¹ã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ä¿å­˜ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: OFFï¼‰
- `--save-transparent`: é€æ˜èƒŒæ™¯ç‰ˆã‚‚ä¿å­˜ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: OFFï¼‰
- `--min-yolo-score FLOAT`: YOLOæœ€å°ã‚¹ã‚³ã‚¢é–¾å€¤ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 0.1ï¼‰
- `--verbose`: è©³ç´°ãªå‡ºåŠ›ã‚’è¡¨ç¤º

## å‡¦ç†ãƒ•ãƒ­ãƒ¼

1. **ç”»åƒå‰å‡¦ç†**: ç”»åƒèª­ã¿è¾¼ã¿ã€ãƒªã‚µã‚¤ã‚ºã€æ­£è¦åŒ–
2. **SAM ãƒã‚¹ã‚¯ç”Ÿæˆ**: å…¨é ˜åŸŸã®ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
3. **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å€™è£œãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: é¢ç©ã€ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã«ã‚ˆã‚‹çµã‚Šè¾¼ã¿
4. **YOLO ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°**: äººç‰©æ¤œå‡ºã‚¹ã‚³ã‚¢ã«ã‚ˆã‚‹æœ€é©ãƒã‚¹ã‚¯é¸æŠ
5. **ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: ãƒ†ã‚­ã‚¹ãƒˆé ˜åŸŸã®é™¤å¤–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
6. **ãƒã‚¹ã‚¯ç²¾è£½**: ã‚¨ãƒƒã‚¸å¹³æ»‘åŒ–ã€ãƒã‚¤ã‚ºé™¤å»
7. **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æŠ½å‡º**: èƒŒæ™¯é™¤å»ã€ã‚¯ãƒ­ãƒƒãƒ—
8. **çµæœä¿å­˜**: æŠ½å‡ºç”»åƒã€ãƒã‚¹ã‚¯ã€é€æ˜èƒŒæ™¯ç‰ˆã®ä¿å­˜

## å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«

- `{name}.jpg`: æŠ½å‡ºã•ã‚ŒãŸã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒï¼ˆé»’èƒŒæ™¯ï¼‰
- `{name}_mask.png`: ã‚»ã‚°ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚¹ã‚¯ï¼ˆ`--save-mask`ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ™‚ï¼‰
- `{name}_transparent.png`: é€æ˜èƒŒæ™¯ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒï¼ˆ`--save-transparent`ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ™‚ï¼‰

## è¦ä»¶

- SAM model checkpoint: `sam_vit_h_4b8939.pth`
- YOLO model: `yolov8n.pt` (è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰)
- æ¨å¥¨GPU ãƒ¡ãƒ¢ãƒª: 6GBä»¥ä¸Š
- æ¨å¥¨RAM: 8GBä»¥ä¸Š

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹

ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œæ™‚ã«ä»¥ä¸‹ã®æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

- å‡¦ç†æ™‚é–“ã®å†…è¨³
- ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ï¼ˆRAM/GPUï¼‰
- ãƒã‚¹ã‚¯å“è³ªãƒ¡ãƒˆãƒªã‚¯ã‚¹
- YOLOæ¤œå‡ºã‚¹ã‚³ã‚¢

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼**
   - ç”»åƒã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹
   - ãƒãƒƒãƒã‚µã‚¤ã‚ºã‚’æ¸›ã‚‰ã™
   - GPUãƒ¡ãƒ¢ãƒªã‚’ç¢ºèª

2. **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒæ¤œå‡ºã•ã‚Œãªã„**
   - `--min-yolo-score` ã‚’ä¸‹ã’ã‚‹ï¼ˆä¾‹: 0.05ï¼‰
   - `--enhance-contrast` ã‚’è©¦ã™
   - ç”»åƒå“è³ªã‚’ç¢ºèª

3. **ãƒ†ã‚­ã‚¹ãƒˆã¨èª¤èªè­˜**
   - `--filter-text` ãŒæœ‰åŠ¹ã‹ç¢ºèª
   - ãƒ†ã‚­ã‚¹ãƒˆå¯†åº¦é–¾å€¤ã‚’èª¿æ•´

### ãƒ­ã‚°å‡ºåŠ›ã®è¦‹æ–¹

```
ğŸ”„ é–‹å§‹: SAM Model Loading (RAM: 2048.1MB, GPU: 0.0MB)
âœ… å®Œäº†: SAM Model Loading (1.23ç§’, RAM: 4096.2MB, GPU: 2048.1MB)
ğŸ“Š ç”Ÿæˆãƒã‚¹ã‚¯: 1245 â†’ ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å€™è£œ: 23
ğŸ¯ æœ€é©ãƒã‚¹ã‚¯é¸æŠ: YOLO score=0.456, combined score=0.623
ğŸ“ ãƒã‚¹ã‚¯å“è³ª: coverage=0.234, compactness=0.789
âœ… ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æŠ½å‡ºå®Œäº†: 5.67ç§’
```

## APIä½¿ç”¨ä¾‹

```python
from commands.extract_character import extract_character_from_path

# å˜ä¸€ç”»åƒå‡¦ç†
result = extract_character_from_path(
    image_path="manga_page.jpg",
    output_path="output/character",
    enhance_contrast=True,
    min_yolo_score=0.15
)

if result['success']:
    print(f"æŠ½å‡ºæˆåŠŸ: {result['output_path']}")
    print(f"å‡¦ç†æ™‚é–“: {result['processing_time']:.2f}ç§’")
else:
    print(f"æŠ½å‡ºå¤±æ•—: {result['error']}")
```

## é–¢é€£ã‚³ãƒãƒ³ãƒ‰

- `/start`: ãƒ¢ãƒ‡ãƒ«åˆæœŸåŒ–ï¼ˆè‡ªå‹•å®Ÿè¡Œï¼‰
- ã‚µãƒ³ãƒ—ãƒ«ç”»åƒ: `assets/masks1.png`
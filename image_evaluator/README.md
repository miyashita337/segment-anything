# 画像抽出結果評価ツール

キャラクター抽出システムの複数バージョン結果を比較評価するためのWebベースツールです。

## 🎯 機能

### 📊 スプレッドシート型インターフェース
- 500x500ピクセル以上での画像表示
- 2つのフォルダー結果を並列比較
- Excel/Googleスプレッドシート風のレイアウト

### 📝 評価システム
- **A-F段階評価**: 優秀(A)から失敗(F)まで6段階
- **再利用可能問題リスト**: 15種類の一般的な問題を選択
- **カスタム問題入力**: 独自の問題も追加可能
- **メモ機能**: 詳細な評価コメント

### 💾 データ管理
- **CSV出力**: 評価結果をExcel等で分析可能
- **進捗保存**: 評価途中での作業保存
- **進捗読み込み**: 中断した評価作業の再開

## 🚀 使用方法

### 1. 環境準備

```bash
cd /mnt/c/AItools/segment-anything/image_evaluator
npm install
```

### 2. サーバー起動

```bash
npm start
```

または開発モード（自動再起動）:

```bash
npm run dev
```

### 3. ブラウザアクセス

http://localhost:3000 にアクセス

### 4. フォルダー設定

比較したい2つのフォルダーパスを入力:

```
フォルダー1: C:/AItools/lora/train/yadokugaeru/clipped_boundingbox/kaname03
フォルダー2: C:/AItools/lora/train/yadokugaeru/clipped_boundingbox/kaname03_0_0_3
```

### 5. 評価実行

1. 「フォルダー読み込み」ボタンクリック
2. 表示された画像ペアを評価
3. 問題リストから該当項目を選択
4. 必要に応じてメモを記入

### 6. 結果出力

- 「CSV出力」: 評価結果をダウンロード
- 「進捗保存」: 作業内容をJSONで保存
- 「進捗読み込み」: 保存済み作業を再開

## 📁 対応ファイル形式

### 画像ファイル
- JPEG (.jpg, .jpeg)
- PNG (.png)
- GIF (.gif)
- BMP (.bmp)
- WebP (.webp)

### 出力ファイル
- **CSV**: 評価結果（Excel等で開ける）
- **JSON**: 進捗データ（再読み込み可能）

## 🔧 評価項目

### 評価段階
- **A (優秀)**: 完璧な抽出
- **B (良好)**: 軽微な問題のみ
- **C (普通)**: 使用可能な品質
- **D (改善要)**: 明確な問題あり
- **E (不良)**: 重大な問題
- **F (失敗)**: 抽出失敗

### 問題カテゴリ
- 抽出範囲不適切
- キャラクター欠損
- 背景残り
- エフェクト線残り
- 境界不正確
- 他キャラクター混入
- 手足切断
- 顔部分欠損
- マスク精度低
- 輪郭ガタガタ
- 透明度異常
- 色調変化
- ノイズ多数
- 解像度不足
- 画質劣化

## 🛠️ 技術仕様

### バックエンド
- **Node.js + Express**: サーバーフレームワーク
- **ファイルシステムAPI**: 画像読み込み
- **静的ファイル配信**: 高速画像表示

### フロントエンド
- **HTML5 + CSS3**: レスポンシブUI
- **Vanilla JavaScript**: フレームワーク不要
- **スプレッドシート風レイアウト**: 直感的操作

### セキュリティ
- パス正規化でディレクトリトラバーサル防止
- ファイル存在チェック
- MIMEタイプ検証

## 📊 使用例

### バージョン比較
```
元バージョン vs Phase 1-3改良版
kaname03/ vs kaname03_0_0_3/
```

### 評価データ例
```csv
ファイル名,フォルダー1評価,フォルダー1問題,フォルダー2評価,フォルダー2問題,メモ
01_kaname03_0000_cover.jpg,B,輪郭ガタガタ,D,背景残り; 境界不正確,Phase1の方が良好
02_kaname03_0001.jpg,A,,F,抽出範囲不適切,Phase1圧勝
```

## 🐛 トラブルシューティング

### 画像が表示されない
- フォルダーパスの確認
- ファイル権限の確認
- 対応形式の確認

### サーバーエラー
- Node.jsバージョン確認 (14.0.0以上)
- ポート3000の空き確認
- ログでエラー詳細確認

### パフォーマンス
- 大量画像時は分割評価推奨
- ブラウザのメモリ使用量監視
- 必要に応じてサーバー再起動

## 📄 ライセンス

MIT License